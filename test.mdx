## Build a Beautiful Waitlist App \+ Admin Using Pica \+ InstantDB

This guide targets Next.js App Router. It provides non-prompt setup steps for Next.js and environment variables, followed by exact prompts to generate features. No MCP required.

### 1) Initialize the Project (App Router)

- Create a new Next.js app with App Router, TypeScript, Tailwind, and ESLint (using create-next-app).
- Add a modern base layout with a dark gradient background and clean typography.
- Import global Tailwind styles and verify the home page renders.

### 2) Environment Variables (direct steps)

- Create a `.env.local` file with:
  - `NEXT_PUBLIC_INSTANT_APP_ID=`
  - `PICA_SECRET_KEY=`
  - `PICA_GMAIL_CONNECTION_KEY=`
- Document where to obtain values in your README:
  - Pica API keys: https://app.picaos.com/settings/api-keys
  - Pica Gmail connection: https://app.picaos.com/connections
- Validate that environment variables are loaded in development.

### Step-by-step build with prompts

<Details title="1) Create Next.js App (App Router)">
  1. Initialize the app with TypeScript, ESLint, Tailwind, and App Router.

  ```bash
  npx create-next-app@latest waitlist-app \
    --ts \
    --eslint \
    --app \
    --tailwind \
    --src-dir=false \
    --import-alias "@/*"
  ```

  2. Start the dev server and verify the app loads.

  ```bash
  cd waitlist-app
  npm run dev
  ```
</Details>

<Details title="2) Environment Variables">
  1. Create a `.env.local` with the following keys:
     * `NEXT_PUBLIC_INSTANT_APP_ID=`
     * `PICA_SECRET_KEY=`
     * `PICA_GMAIL_CONNECTION_KEY=`
  2. Get values from:
     * Pica API keys: [https://app.picaos.com/settings/api-keys](https://app.picaos.com/settings/api-keys)
     * Pica Gmail connection: [https://app.picaos.com/connections](https://app.picaos.com/connections)
</Details>

<Details title="3) InstantDB Client and Schema (lib/db.ts)">
  Paste this prompt into your assistant so it creates the client file:

  ```text
  Create a TypeScript file at path: lib/db.ts

  Requirements:
  - Use imports:
    import { init } from '@instantdb/react';
    import { i } from '@instantdb/core';
  - Define a schema with one entity: signups
    - Fields:
      - name: string
      - email: string
      - interest: string (optional)
      - status: string // 'pending', 'confirmed', 'notified'
      - welcomeEmailSent: boolean
      - createdAt: date
  - Initialize and export an InstantDB client with this schema using NEXT_PUBLIC_INSTANT_APP_ID
  - Export the schema type

  File contents:
  ------------------------------------------------
  import { init } from '@instantdb/react';
  import { i } from '@instantdb/core';

  // Define your schema
  const schema = i.schema({
    entities: {
      signups: i.entity({
        name: i.string(),
        email: i.string(),
        interest: i.string().optional(),
        status: i.string(), // 'pending', 'confirmed', 'notified'
        welcomeEmailSent: i.boolean(),
        createdAt: i.date(),
      }),
    },
  });

  export const db = init({
    appId: process.env.NEXT_PUBLIC_INSTANT_APP_ID!,
    schema,
  });

  export type Schema = typeof schema;
  ------------------------------------------------

  Notes:
  - Do not change indentation or spacing.
  - Do not add extra comments or code.
  ```
</Details>

<Details title="4) Email API Route (app/api/send-welcome-email/route.ts)">
  Paste this prompt to create the API route that sends email via Pica Gmail passthrough:

  ```text
  Create a TypeScript file at path: app/api/send-welcome-email/route.ts

  Requirements:
  - App Router API route (Next.js 13+):
    import { NextRequest, NextResponse } from 'next/server';
  - Parse JSON body: { name: string; email: string; signupId: string }
  - Construct an HTML email with a styled welcome message (as provided below)
  - Build a MIME message with:
    From: your Gmail (placeholder: your-email@gmail.com)
    To, Subject, MIME-Version, Content-Type: text/html; charset=UTF-8
  - Base64url-encode the MIME (Gmail requirement)
  - Call Pica Gmail passthrough:
    POST https://api.picaos.com/v1/passthrough/users/me/messages
    Headers:
      - x-pica-secret: process.env.PICA_SECRET_KEY!
      - x-pica-connection-key: process.env.PICA_GMAIL_CONNECTION_KEY!
      - x-pica-action-id: 'conn_mod_def::F_JeJ3qaLEg::v9ICSQZxR0un5_ketxbCAQ'
      - Content-Type: application/json
    Body: { raw: <base64url string>, labelIds: ['INBOX','UNREAD'] }
  - On success: return { success: true, messageId, message }
  - On error: return 500 with { success: false, error, details }

  Exact file contents:
  ------------------------------------------------
  import { NextRequest, NextResponse } from 'next/server';

  interface WelcomeEmailRequest {
    name: string;
    email: string;
    signupId: string;
  }

  export async function POST(request: NextRequest) {
    try {
      const { name, email }: WelcomeEmailRequest = await request.json();

      console.log('üìß Sending email to:', email);

      // Get current date for subject
      const currentDate = new Date().toLocaleDateString('en-US', {
        month: 'long',
        day: 'numeric', 
        year: 'numeric'
      });

      const subject = `üéâ Welcome to the Waiting List!`;

      // Create HTML email body
      const htmlBody = `
      <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 600px; margin: 0 auto; background: #ffffff; color: #2c3e50; line-height: 1.7; font-size: 16px; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px 10px 0 0; text-align: center;">
          <h1>Welcome Aboard! üöÄ</h1>
        </div>
        <div style="background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px;">
          <h2>Hi ${name}!</h2>
          <p>Thank you for joining our exclusive waiting list! You're now part of an amazing community of early adopters.</p>
          
          <p><strong>What happens next?</strong></p>
          <ul style="margin: 15px 0; padding-left: 25px; list-style-type: disc;">
            <li style="margin: 8px 0;">You'll be among the first to know about our launch</li>
            <li style="margin: 8px 0;">Get exclusive early access to new features</li>
            <li style="margin: 8px 0;">Receive special launch pricing</li>
          </ul>
          
          <p>Stay tuned for exciting updates!</p>
          
          <p>Best regards,<br>
          The Team</p>
        </div>
      </div>

      <hr style="border: none; border-top: 1px solid #eee; margin: 30px 0;">
      <p style="color: #666; font-size: 12px; text-align: center;">
        Generated automatically by Waiting List System<br>
        Powered by InstantDB & Pica
      </p>`;

      // Construct proper MIME email
      const mimeEmail = [
        `From: your-email@gmail.com`, // Replace with your actual Gmail
        `To: ${email}`,
        `Subject: ${subject}`,
        'MIME-Version: 1.0',
        'Content-Type: text/html; charset=UTF-8',
        '',
        htmlBody,
      ].join('\r\n');

      console.log('üìù MIME email constructed');

      // Encode to base64url (Gmail API requirement) 
      const encoder = new TextEncoder();
      const data = encoder.encode(mimeEmail);
      const base64 = btoa(String.fromCharCode(...data));
      const encodedEmail = base64
        .replace(/\+/g, '-')
        .replace(/\//g, '_')
        .replace(/=/g, '');

      console.log('üîê Email encoded to base64url');

      // Send via Pica Gmail API
      const response = await fetch('https://api.picaos.com/v1/passthrough/users/me/messages', {
        method: 'POST',
        headers: {
          'x-pica-secret': process.env.PICA_SECRET_KEY!,
          'x-pica-connection-key': process.env.PICA_GMAIL_CONNECTION_KEY!,
          'x-pica-action-id': 'conn_mod_def::F_JeJ3qaLEg::v9ICSQZxR0un5_ketxbCAQ',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ 
          raw: encodedEmail,
          labelIds: ['INBOX', 'UNREAD']
        })
      });

      console.log(`üì° Pica response status: ${response.status}`, process.env.PICA_GMAIL_CONNECTION_KEY);

      if (!response.ok) {
        const errorText = await response.text();
        console.error('‚ùå Pica error response:', errorText);
        throw new Error(`Pica API error: ${response.status} - ${errorText}`);
      }

      const result = await response.json();
      console.log('‚úÖ Email sent successfully:', result);
      
      return NextResponse.json({ 
        success: true, 
        messageId: result.id,
        message: 'Welcome email sent successfully!' 
      });

    } catch (error) {
      console.error('üí• Error sending welcome email:', error);
      
      return NextResponse.json(
        { 
          success: false, 
          error: 'Failed to send welcome email',
          details: error instanceof Error ? error.message : 'Unknown error'
        },
        { status: 500 }
      );
    }
  }
  ------------------------------------------------

  Environment variables required in .env.local:
  - NEXT_PUBLIC_INSTANT_APP_ID=...
  - PICA_SECRET_KEY=...
  - PICA_GMAIL_CONNECTION_KEY=...

  Notes:
  - Replace the From address with your connected Gmail.
  - Keep the exact indentation and spacing.
  ```
</Details>

<Details title="5) Create the UI (app/page.tsx)">
  Use this prompt to generate the client form page. It includes loading/success/error states and uses InstantDB transactions correctly.

  ```text
  Design a beautiful client form in app/page.tsx with fields: name, email, interest (select with early-access, pricing, features, updates). Style with a glassy/gradient card. On submit:
  1) Create a `signups` record in InstantDB with status 'pending' and welcomeEmailSent false
  2) Call /api/send-welcome-email with { name, email, signupId }
  3) On success, set status 'notified' and welcomeEmailSent true
  Show loading, success, and error states; reset form on success; ensure accessibility.

  Important: Use InstantDB transactions exactly as follows so it works on first try:
  - Import `id` from `@instantdb/core`
  - Generate an id with `const signupId = id()`
  - Create: `await db.transact([db.tx.signups[signupId].create({ name, email, interest, status: 'pending', welcomeEmailSent: false, createdAt: new Date() })])`
  - Update: `await db.transact([db.tx.signups[signupId].update({ status: 'notified', welcomeEmailSent: true })])`
  ```
</Details>

<Details title="6) Admin Dashboard (app/admin)">
  Use these prompts to generate the admin page and dashboard table with filters and actions.

  ```text
  Create an admin page at app/admin/page.tsx and a dashboard component. Display a table of signups with columns: name, email, interest, status, createdAt. Add a status filter (all | pending | notified | confirmed). Provide per-row actions to set status to 'confirmed' or back to 'pending' using InstantDB; implement optimistic updates and graceful error recovery.
  ```

  ```text
  Add routes:
  1) GET app/api/signups ‚Üí returns list of signups (support ?status=)
  2) POST app/api/signups/[id]/status ‚Üí body { status: 'pending' | 'notified' | 'confirmed' }
  Validate inputs, return JSON responses, handle errors cleanly, and ensure no secrets are exposed to the client.
  ```
</Details>

### 3) Prompt ‚Äî InstantDB Client and Schema (lib/db.ts)

```text
Create a TypeScript file at path: lib/db.ts

Requirements:
- Use imports:
  import { init } from '@instantdb/react';
  import { i } from '@instantdb/core';
- Define a schema with one entity: signups
  - Fields:
    - name: string
    - email: string
    - interest: string (optional)
    - status: string // 'pending', 'confirmed', 'notified'
    - welcomeEmailSent: boolean
    - createdAt: date
- Initialize and export an InstantDB client with this schema using NEXT_PUBLIC_INSTANT_APP_ID
- Export the schema type

File contents:
------------------------------------------------
import { init } from '@instantdb/react';
import { i } from '@instantdb/core';

// Define your schema
const schema = i.schema({
  entities: {
    signups: i.entity({
      name: i.string(),
      email: i.string(),
      interest: i.string().optional(),
      status: i.string(), // 'pending', 'confirmed', 'notified'
      welcomeEmailSent: i.boolean(),
      createdAt: i.date(),
    }),
  },
});

export const db = init({
  appId: process.env.NEXT_PUBLIC_INSTANT_APP_ID!,
  schema,
});

export type Schema = typeof schema;
------------------------------------------------

Notes:
- Do not change indentation or spacing.
- Do not add extra comments or code.
```

### 4) Prompt ‚Äî Email API Route (app/api/send-welcome-email/route.ts)

```text
Create a TypeScript file at path: app/api/send-welcome-email/route.ts

Requirements:
- App Router API route (Next.js 13+):
  import { NextRequest, NextResponse } from 'next/server';
- Parse JSON body: { name: string; email: string; signupId: string }
- Construct an HTML email with a styled welcome message (as provided below)
- Build a MIME message with:
  From: your Gmail (placeholder: your-email@gmail.com)
  To, Subject, MIME-Version, Content-Type: text/html; charset=UTF-8
- Base64url-encode the MIME (Gmail requirement)
- Call Pica Gmail passthrough:
  POST https://api.picaos.com/v1/passthrough/users/me/messages
  Headers:
    - x-pica-secret: process.env.PICA_SECRET_KEY!
    - x-pica-connection-key: process.env.PICA_GMAIL_CONNECTION_KEY!
    - x-pica-action-id: 'conn_mod_def::F_JeJ3qaLEg::v9ICSQZxR0un5_ketxbCAQ'
    - Content-Type: application/json
  Body: { raw: <base64url string>, labelIds: ['INBOX','UNREAD'] }
- On success: return { success: true, messageId, message }
- On error: return 500 with { success: false, error, details }

Exact file contents:
------------------------------------------------
import { NextRequest, NextResponse } from 'next/server';

interface WelcomeEmailRequest {
  name: string;
  email: string;
  signupId: string;
}

export async function POST(request: NextRequest) {
  try {
    const { name, email }: WelcomeEmailRequest = await request.json();

    console.log('üìß Sending email to:', email);

    // Get current date for subject
    const currentDate = new Date().toLocaleDateString('en-US', {
      month: 'long',
      day: 'numeric', 
      year: 'numeric'
    });

    const subject = `üéâ Welcome to the Waiting List!`;

    // Create HTML email body
    const htmlBody = `
    <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 600px; margin: 0 auto; background: #ffffff; color: #2c3e50; line-height: 1.7; font-size: 16px; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
      <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px 10px 0 0; text-align: center;">
        <h1>Welcome Aboard! üöÄ</h1>
      </div>
      <div style="background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px;">
        <h2>Hi ${name}!</h2>
        <p>Thank you for joining our exclusive waiting list! You're now part of an amazing community of early adopters.</p>
        
        <p><strong>What happens next?</strong></p>
        <ul style="margin: 15px 0; padding-left: 25px; list-style-type: disc;">
          <li style="margin: 8px 0;">You'll be among the first to know about our launch</li>
          <li style="margin: 8px 0;">Get exclusive early access to new features</li>
          <li style="margin: 8px 0;">Receive special launch pricing</li>
        </ul>
        
        <p>Stay tuned for exciting updates!</p>
        
        <p>Best regards,<br>
        The Team</p>
      </div>
    </div>

    <hr style="border: none; border-top: 1px solid #eee; margin: 30px 0;">
    <p style="color: #666; font-size: 12px; text-align: center;">
      Generated automatically by Waiting List System<br>
      Powered by InstantDB & Pica
    </p>`;

    // Construct proper MIME email
    const mimeEmail = [
      `From: your-email@gmail.com`, // Replace with your actual Gmail
      `To: ${email}`,
      `Subject: ${subject}`,
      'MIME-Version: 1.0',
      'Content-Type: text/html; charset=UTF-8',
      '',
      htmlBody,
    ].join('\r\n');

    console.log('üìù MIME email constructed');

    // Encode to base64url (Gmail API requirement) 
    const encoder = new TextEncoder();
    const data = encoder.encode(mimeEmail);
    const base64 = btoa(String.fromCharCode(...data));
    const encodedEmail = base64
      .replace(/\+/g, '-')
      .replace(/\//g, '_')
      .replace(/=/g, '');

    console.log('üîê Email encoded to base64url');

    // Send via Pica Gmail API
    const response = await fetch('https://api.picaos.com/v1/passthrough/users/me/messages', {
      method: 'POST',
      headers: {
        'x-pica-secret': process.env.PICA_SECRET_KEY!,
        'x-pica-connection-key': process.env.PICA_GMAIL_CONNECTION_KEY!,
        'x-pica-action-id': 'conn_mod_def::F_JeJ3qaLEg::v9ICSQZxR0un5_ketxbCAQ',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ 
        raw: encodedEmail,
        labelIds: ['INBOX', 'UNREAD']
      })
    });

    console.log(`üì° Pica response status: ${response.status}`, process.env.PICA_GMAIL_CONNECTION_KEY);

    if (!response.ok) {
      const errorText = await response.text();
      console.error('‚ùå Pica error response:', errorText);
      throw new Error(`Pica API error: ${response.status} - ${errorText}`);
    }

    const result = await response.json();
    console.log('‚úÖ Email sent successfully:', result);
    
    return NextResponse.json({ 
      success: true, 
      messageId: result.id,
      message: 'Welcome email sent successfully!' 
    });

  } catch (error) {
    console.error('üí• Error sending welcome email:', error);
    
    return NextResponse.json(
      { 
        success: false, 
        error: 'Failed to send welcome email',
        details: error instanceof Error ? error.message : 'Unknown error'
      },
      { status: 500 }
    );
  }
}
------------------------------------------------

Environment variables required in .env.local:
- NEXT_PUBLIC_INSTANT_APP_ID=...
- PICA_SECRET_KEY=...
- PICA_GMAIL_CONNECTION_KEY=...

Notes:
- Replace the From address with your connected Gmail.
- Keep the exact indentation and spacing.
```

### 5) Attractive Waitlist Form UI

```text
Design a beautiful client form in app/page.tsx with fields: name, email, interest (select with early-access, pricing, features, updates). Style with a glassy/gradient card. On submit:
1) Create a `signups` record in InstantDB with status 'pending' and welcomeEmailSent false
2) Call /api/send-welcome-email with { name, email, signupId }
3) On success, set status 'notified' and welcomeEmailSent true
Show loading, success, and error states; reset form on success; ensure accessibility.

Important: Use InstantDB transactions exactly as follows so it works on first try:
- Import `id` from `@instantdb/core`
- Generate an id with `const signupId = id()`
- Create: `await db.transact([db.tx.signups[signupId].create({ name, email, interest, status: 'pending', welcomeEmailSent: false, createdAt: new Date() })])`
- Update: `await db.transact([db.tx.signups[signupId].update({ status: 'notified', welcomeEmailSent: true })])`
```

### 6) UX Polish and Metrics

```text
Add a simple success toast (or inline success message) and a signup counter sourced from InstantDB. Ensure mobile responsiveness, keyboard accessibility, and focus management for errors.
```

### 7) Admin Panel (Dashboard)

```text
Create an admin page at app/admin/page.tsx and a dashboard component. Display a table of signups with columns: name, email, interest, status, createdAt. Add a status filter (all | pending | notified | confirmed). Provide per-row actions to set status to 'confirmed' or back to 'pending' using InstantDB; implement optimistic updates and graceful error recovery.
```

---

References: [Pica API Keys](https://app.picaos.com/settings/api-keys), [Pica Connections](https://app.picaos.com/connections)